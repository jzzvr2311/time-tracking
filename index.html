<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biometric Time Tracking</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as SVG components
        const Clock = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const Download = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const LogIn = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                <polyline points="10 17 15 12 10 7"></polyline>
                <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
        );

        const LogOut = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Filter = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
        );

        const X = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const BiometricTimeTracking = () => {
            const [currentTime, setCurrentTime] = useState(new Date());
            const [employeeName, setEmployeeName] = useState('Jazzver Lotoc');
            const [timeInRecorded, setTimeInRecorded] = useState(null);
            const [timeOutRecorded, setTimeOutRecorded] = useState(null);
            const [records, setRecords] = useState([]);
            const [showNotification, setShowNotification] = useState(false);
            const [notificationMessage, setNotificationMessage] = useState('');
            const [isLoading, setIsLoading] = useState(true);
            const [filterDate, setFilterDate] = useState('');
            const [filterDay, setFilterDay] = useState('');
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [showClearConfirm, setShowClearConfirm] = useState(false);
            const [recordToDelete, setRecordToDelete] = useState(null);

            useEffect(() => {
                loadData();
            }, []);

            const loadData = () => {
                try {
                    const stored = localStorage.getItem('time-tracking-records');
                    if (stored) {
                        const data = JSON.parse(stored);
                        setRecords(data.records || []);
                        setEmployeeName(data.employeeName || 'Jazzver Lotoc');
                    }
                } catch (error) {
                    console.log('No existing data found, starting fresh');
                }
                setIsLoading(false);
            };

            const saveData = (newRecords, empName) => {
                try {
                    const data = {
                        records: newRecords,
                        employeeName: empName
                    };
                    localStorage.setItem('time-tracking-records', JSON.stringify(data));
                } catch (error) {
                    console.error('Error saving data:', error);
                    showNotif('Error saving data');
                }
            };

            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            const formatTime = (date) => {
                return date.toLocaleTimeString('en-US', { 
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            };

            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', {
                    month: 'long',
                    day: '2-digit',
                    year: 'numeric'
                });
            };

            const formatDateShort = (date) => {
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: '2-digit',
                    year: 'numeric'
                });
            };

            const getDayOfWeek = (dateString) => {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { weekday: 'long' });
            };

            const showNotif = (message) => {
                setNotificationMessage(message);
                setShowNotification(true);
                setTimeout(() => setShowNotification(false), 3000);
            };

            const handleTimeIn = () => {
                const hasPendingRecord = records.some(record => !record.timeOut);
                
                if (hasPendingRecord) {
                    showNotif('Please log Time Out first before logging Time In again');
                    return;
                }
                
                const now = new Date();
                setTimeInRecorded(now);
                setTimeOutRecorded(null);
                
                const newRecord = {
                    date: formatDateShort(now),
                    name: employeeName,
                    timeIn: formatTime(now),
                    timeOut: '',
                    id: Date.now(),
                    dayOfWeek: getDayOfWeek(now)
                };
                
                const updatedRecords = [newRecord, ...records];
                setRecords(updatedRecords);
                saveData(updatedRecords, employeeName);
                showNotif('Time In Recorded');
            };

            const handleTimeOut = () => {
                const now = new Date();
                
                const updatedRecords = [...records];
                const recordToUpdate = updatedRecords.find(record => !record.timeOut);
                
                if (recordToUpdate) {
                    recordToUpdate.timeOut = formatTime(now);
                    setTimeOutRecorded(now);
                    setRecords(updatedRecords);
                    saveData(updatedRecords, employeeName);
                    showNotif(`Time Out Recorded - Logged at ${formatTime(now)}`);
                } else {
                    showNotif('Please log Time In first');
                }
            };

            const handleEmployeeNameChange = (value) => {
                setEmployeeName(value);
                saveData(records, value);
            };

            const deleteRecord = (id) => {
                setRecordToDelete(id);
                setShowDeleteConfirm(true);
            };

            const confirmDelete = () => {
                if (recordToDelete) {
                    const updatedRecords = records.filter(record => record.id !== recordToDelete);
                    setRecords(updatedRecords);
                    saveData(updatedRecords, employeeName);
                    showNotif('Record deleted');
                    setShowDeleteConfirm(false);
                    setRecordToDelete(null);
                }
            };

            const cancelDelete = () => {
                setShowDeleteConfirm(false);
                setRecordToDelete(null);
            };

            const clearAllData = () => {
                setShowClearConfirm(true);
            };

            const confirmClearAll = () => {
                try {
                    localStorage.removeItem('time-tracking-records');
                    setRecords([]);
                    showNotif('All records cleared');
                    setShowClearConfirm(false);
                } catch (error) {
                    console.error('Error clearing data:', error);
                }
            };

            const cancelClearAll = () => {
                setShowClearConfirm(false);
            };

            const clearFilters = () => {
                setFilterDate('');
                setFilterDay('');
            };

            const filteredRecords = records.filter(record => {
                let matchesDate = true;
                let matchesDay = true;

                if (filterDate) {
                    const recordDate = new Date(record.date);
                    const selectedDate = new Date(filterDate);
                    matchesDate = recordDate.toDateString() === selectedDate.toDateString();
                }

                if (filterDay) {
                    matchesDay = record.dayOfWeek === filterDay;
                }

                return matchesDate && matchesDay;
            });

            const exportToExcel = () => {
                const dataToExport = filteredRecords.length > 0 ? filteredRecords : records;
                let csv = 'DATE,DAY,NAME,TIME IN,TIME OUT\n';
                dataToExport.forEach(record => {
                    csv += `${record.date},${record.dayOfWeek || ''},${record.name},${record.timeIn},${record.timeOut || ''}\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', 'time_tracking_records.csv');
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            };

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-gray-600">Loading...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 p-8">
                    {showNotification && (
                        <div className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50">
                            {notificationMessage}
                        </div>
                    )}

                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                                <h3 className="text-lg font-bold text-gray-800 mb-2">Delete Record</h3>
                                <p className="text-gray-600 mb-6">Are you sure you want to delete this record? This action cannot be undone.</p>
                                <div className="flex gap-3 justify-end">
                                    <button onClick={cancelDelete} className="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition-colors">
                                        Cancel
                                    </button>
                                    <button onClick={confirmDelete} className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showClearConfirm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                                <h3 className="text-lg font-bold text-gray-800 mb-2">Clear All Records</h3>
                                <p className="text-gray-600 mb-6">Are you sure you want to clear all records? This action cannot be undone and all your time tracking data will be permanently deleted.</p>
                                <div className="flex gap-3 justify-end">
                                    <button onClick={cancelClearAll} className="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition-colors">
                                        Cancel
                                    </button>
                                    <button onClick={confirmClearAll} className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                                        Clear All
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-6xl mx-auto">
                        <div className="flex justify-between items-center mb-8">
                            <div className="flex items-center gap-3">
                                <Clock />
                                <h1 className="text-2xl font-bold text-gray-800">Biometric Time Tracking</h1>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={clearAllData} className="flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 border border-red-200 rounded-lg hover:bg-red-100 transition-colors">
                                    <Trash2 />
                                    Clear All
                                </button>
                                <button onClick={exportToExcel} className="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    <Download />
                                    Export to Excel
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-sm p-8 mb-8">
                            <h2 className="text-2xl font-bold text-gray-800 mb-2">Time Logging</h2>
                            <p className="text-gray-600 mb-6">Record your attendance by logging time in and time out</p>

                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-700 mb-2">Employee Name</label>
                                <input
                                    type="text"
                                    value={employeeName}
                                    onChange={(e) => handleEmployeeNameChange(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                />
                            </div>

                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <button
                                    onClick={handleTimeIn}
                                    disabled={records.some(record => !record.timeOut)}
                                    className={`${records.some(record => !record.timeOut) ? 'bg-blue-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'} text-white font-medium py-4 px-6 rounded-lg transition-colors flex items-center justify-center gap-2`}
                                >
                                    <LogIn />
                                    Time In
                                </button>
                                <button
                                    onClick={handleTimeOut}
                                    disabled={!records.some(record => !record.timeOut)}
                                    className={`${!records.some(record => !record.timeOut) ? 'bg-gray-100 cursor-not-allowed text-gray-400' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'} font-medium py-4 px-6 rounded-lg transition-colors flex items-center justify-center gap-2`}
                                >
                                    <LogOut />
                                    Time Out
                                </button>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <div className="border border-gray-200 rounded-lg p-4 text-center">
                                    <p className="text-sm text-gray-600 mb-2">{formatDate(currentTime)}</p>
                                    <p className="text-3xl font-bold text-gray-800">
                                        {timeInRecorded ? formatTime(timeInRecorded) : formatTime(currentTime)}
                                    </p>
                                </div>
                                <div className="border border-gray-200 rounded-lg p-4 text-center">
                                    <p className="text-sm text-gray-600 mb-2">{formatDate(currentTime)}</p>
                                    <p className="text-3xl font-bold text-gray-800">
                                        {timeOutRecorded ? formatTime(timeOutRecorded) : formatTime(currentTime)}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-sm p-8">
                            <div className="flex justify-between items-center mb-6">
                                <div>
                                    <h2 className="text-xl font-bold text-gray-800 mb-2">Recent Records</h2>
                                    <p className="text-gray-600">
                                        {filteredRecords.length === records.length 
                                            ? `View all time logging history (${records.length} records)`
                                            : `Showing ${filteredRecords.length} of ${records.length} records`}
                                    </p>
                                </div>
                            </div>

                            <div className="bg-gray-50 p-4 rounded-lg mb-6">
                                <div className="flex items-center gap-2 mb-3">
                                    <Filter />
                                    <h3 className="font-medium text-gray-800">Filter Records</h3>
                                </div>
                                <div className="grid grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Filter by Date</label>
                                        <input
                                            type="date"
                                            value={filterDate}
                                            onChange={(e) => setFilterDate(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Filter by Day</label>
                                        <select
                                            value={filterDay}
                                            onChange={(e) => setFilterDay(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        >
                                            <option value="">All Days</option>
                                            <option value="Monday">Monday</option>
                                            <option value="Tuesday">Tuesday</option>
                                            <option value="Wednesday">Wednesday</option>
                                            <option value="Thursday">Thursday</option>
                                            <option value="Friday">Friday</option>
                                            <option value="Saturday">Saturday</option>
                                            <option value="Sunday">Sunday</option>
                                        </select>
                                    </div>
                                    <div className="flex items-end">
                                        <button onClick={clearFilters} className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition-colors">
                                            <X />
                                            Clear Filters
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {filteredRecords.length === 0 ? (
                                <div className="text-center py-12 text-gray-500">
                                    {records.length === 0 
                                        ? 'No records yet. Log your first time in and time out to get started!'
                                        : 'No records match the selected filters.'}
                                </div>
                            ) : (
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="border-b border-gray-200">
                                                <th className="text-left py-3 px-4 text-sm font-medium text-gray-700 uppercase">Date</th>
                                                <th className="text-left py-3 px-4 text-sm font-medium text-gray-700 uppercase">Day</th>
                                                <th className="text-left py-3 px-4 text-sm font-medium text-gray-700 uppercase">Name</th>
                                                <th className="text-left py-3 px-4 text-sm font-medium text-gray-700 uppercase">Time In</th>
                                                <th className="text-left py-3 px-4 text-sm font-medium text-gray-700 uppercase">Time Out</th>
                                                <th className="text-left py-3 px-4 text-sm font-medium text-gray-700 uppercase">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {filteredRecords.map((record) => (
                                                <tr key={record.id} className="border-b border-gray-100 hover:bg-gray-50">
                                                    <td className="py-4 px-4 text-gray-800">{record.date}</td>
                                                    <td className="py-4 px-4 text-gray-800">{record.dayOfWeek}</td>
                                                    <td className="py-4 px-4 text-gray-800">{record.name}</td>
                                                    <td className="py-4 px-4 text-gray-800">{record.timeIn}</td>
                                                    <td className="py-4 px-4 text-gray-800">
                                                        {record.timeOut || <span className="text-gray-400 italic">Pending</span>}
                                                    </td>
                                                    <td className="py-4 px-4">
                                                        <button onClick={() => deleteRecord(record.id)} className="text-red-600 hover:text-red-800 transition-colors">
                                                            <Trash2 />
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<BiometricTimeTracking />, document.getElementById('root'));
    </script>
</body>
</html>